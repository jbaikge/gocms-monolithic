<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Class Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style type="text/css">
      @media (min-width: 992px) {
        main > aside {
          width: 24ch;
          min-height: 100vh;
          flex-shrink: 0;
        }
      }
      .class-fields:empty::after {
        background-color: var(--bs-secondary);
        color: var(--bs-light);
        text-align: center;
        content: 'Drag fields here';
        padding: 1em 0;
      }
      .class-fields li:not(:last-child)::after {
        display: block;
        content: '';
        border-bottom: 1px solid var(--bs-secondary);
        padding-top: 1rem;
      }
      .sortable-ghost {
        opacity: 0.5;
      }
      .sortable-handle {
        background-color: var(--bs-secondary);
        color: var(--bs-light);
        padding: 0 3px;
        align-items: center;
        cursor: grab;
      }
    </style>
  </head>
  <body>
    <main class="d-lg-flex">
      <aside class="text-light bg-dark p-3">
        <div>GoCMS</div>
        <nav>
          <ul class="list-unstyled">
            <li>
              <a href="#" class="link-primary align-items-center collapsed" data-bs-toggle="collapse" data-bs-target="#class-collapse" aria-expanded="true">Classes</a>
              <ul class="list-unstyled small collapse ps-3" id="class-collapse">
                <li><a href="#" class="link-secondary">New Class</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </aside>
      <article class="flex-grow-1 p-3">
          <h1 class="fs-2 mb-3">My Class Fields</h1>
          <form method="post">
            <ul id="class-fields" class="list-unstyled d-grid gap-3 class-fields"><!-- No spaces so :empty triggers --></ul>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
      </article>
      <aside class="bg-dark text-secondary p-3">
        <ul id="field-types" class="list-unstyled d-grid gap-3">
          <li class="d-grid" data-template="date" data-type="date" data-label="Date"><button class="btn btn-secondary">Date</button></li>
          <li class="d-grid" data-template="date" data-type="datetime-local" data-label="Date &amp; Time"><button class="btn btn-secondary">Date &amp; Time</button></li>
          <li class="d-grid" data-template="email" data-type="email" data-label="Email"><button class="btn btn-secondary">Email</button></li>
          <li class="d-grid" data-template="select" data-type="multiselect" data-label="Multi-Select"><button class="btn btn-secondary">Multi-Select</button></li>
          <li class="d-grid" data-template="number" data-type="number" data-label="Number"><button class="btn btn-secondary">Number</button></li>
          <li class="d-grid" data-template="section" data-type="section" data-label="Section"><button class="btn btn-secondary">Section</button></li>
          <li class="d-grid" data-template="select" data-type="select" data-label="Select"><button class="btn btn-secondary">Select</button></li>
          <li class="d-grid" data-template="text" data-type="text" data-label="Text"><button class="btn btn-secondary">Text</button></li>
          <li class="d-grid" data-template="textarea" data-type="textarea" data-label="Textarea"><button class="btn btn-secondary">Textarea</button></li>
          <li class="d-grid" data-template="date" data-type="time" data-label="Time"><button class="btn btn-secondary">Time</button></li>
          <li class="d-grid" data-template="tinymce" data-type="tinymce" data-label="TinyMCE"><button class="btn btn-secondary">TinyMCE</button></li>
        </ul>
      </aside>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uuid@latest/dist/umd/uuidv4.min.js"></script>
    <script>
      const fieldTypes = document.getElementById('field-types');
      const fieldTypesOptions = {
        group: {
          name: 'field-types',
          pull: 'clone',
        },
        sort: false, // Disable sorting as we only want to pull from this list
      };
      Sortable.create(fieldTypes, fieldTypesOptions);

      const classFields = document.getElementById('class-fields');
      const classFieldsOptions = {
        group: {
          name: 'class-fields',
          put: 'field-types',
        },
        animation: 150,
        emptyInsertThreshold: 20, // defaults to 5
        handle: '.sortable-handle',
        onAdd: function(event) {
          const data = event.item.dataset;
          const templateId = 'field-' + data.template;
          const uuid = uuidv4();
          const replacements = [
            ['field', document.getElementById(templateId).innerHTML],
            ['type', data.type],
            ['label', data.label],
            ['uuid', uuid],
            ['id', 'field-' + uuid],
          ];

          let html = document.getElementById('field-row').innerHTML;
          replacements.forEach(set => {
            const search = '$' + set[0] + '$';
            html = html.replaceAll(search, set[1]);
          });

          event.item.innerHTML = html;
          event.item.setAttribute('id', 'item-' + uuid);
          event.item.querySelector('button.btn-close').addEventListener('click', function(event) {
            event.preventDefault();
            const item = document.getElementById(event.target.dataset.target);
            item.parentNode.removeChild(item);
          });
        },
      };
      Sortable.create(classFields, classFieldsOptions);
    </script>
    <script id="field-row" type="text/template">
      <div class="d-flex">
        <div class="d-flex sortable-handle">::</div>
        <div class="flex-grow-1 mx-3">
          <h2 class="fs-5 field-type-name">$label$</h2>
          $field$
          <input type="hidden" name="type[$id$]" value="$type$">
        </div>
        <div class="d-flex align-items-start">
          <button type="button" class="btn btn-close" aria-label="Remove" data-target="item-$uuid$"></button>
        </div>
      </div>
    </script>
    <script id="field-text" type="text/template">
      <div class="d-lg-flex gap-3 pb-3">
        <div class="w-50">
          <label for="$id$-label">Label</label>
          <input type="text" id="$id$-label" class="form-control" name="label[$id$]" value="" required>
        </div>
        <div class="w-50">
          <label for="$id$-name">Name</label>
          <input type="text" id="$id$-name" class="form-control" name="name[$id$]" value="" required>
        </div>
      </div>
    </script>
    <script id="field-date" type="text/template">
      <div class="d-lg-flex gap-3 pb-3">
        <div class="w-50">
          <label for="$id$-label">Label</label>
          <input type="text" id="$id$-label" class="form-control" name="label[$id$]" value="" required>
        </div>
        <div class="w-50">
          <label for="$id$-name">Name</label>
          <input type="text" id="$id$-name" class="form-control" name="name[$id$]" value="" required>
        </div>
      </div>
      <div class="d-lg-flex gap-3 pb-3">
        <div class="w-25">
          <label for="$id$-min">Min</label>
          <input type="text" id="$id$-min" class="form-control" name="min[$id$]" value="">
        </div>
        <div class="w-25">
          <label for="$id$-max">Max</label>
          <input type="text" id="$id$-max" class="form-control" name="max[$id$]" value="">
        </div>
        <div class="w-25">
          <label for="$id$-step">Step</label>
          <input type="text" id="$id$-step" class="form-control" name="step[$id$]" value="">
        </div>
        <div class="w-25">
          <label>Value Requirement</label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="1" id="$id$-required">
            <label class="form-check-label" for="$id$-required">Required</label>
          </div>
        </div>
      </div>
    </script>
    <script id="field-number" type="text/template">
      <div class="d-lg-flex gap-3 pb-3">
        <div class="w-50">
          <label for="$id$-label">Label</label>
          <input type="text" id="$id$-label" class="form-control" name="label[$id$]" value="" required>
        </div>
        <div class="w-50">
          <label for="$id$-name">Name</label>
          <input type="text" id="$id$-name" class="form-control" name="name[$id$]" value="" required>
        </div>
      </div>
      <div class="d-lg-flex gap-3 pb-3">
        <div class="w-25">
          <label for="$id$-min">Min</label>
          <input type="text" id="$id$-min" class="form-control" name="min[$id$]" value="">
        </div>
        <div class="w-25">
          <label for="$id$-max">Max</label>
          <input type="text" id="$id$-max" class="form-control" name="max[$id$]" value="">
        </div>
        <div class="w-25">
          <label for="$id$-step">Step</label>
          <input type="text" id="$id$-step" class="form-control" name="step[$id$]" value="">
        </div>
        <div class="w-25"></div>
      </div>
    </script>
  </body>
</html>
